if(typeof window==="undefined"){window={setTimeout:function(A,B){setTimeout(A,B)}}}var Base=function(){};Base.extend=function(B,E){var F=Base.prototype.extend;Base._prototyping=true;var D=new this;F.call(D,B);D.base=function(){};delete Base._prototyping;var C=D.constructor;var A=D.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==A){this._constructing=true;C.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||F).call(arguments[0],D)}}}};A.ancestor=this;A.extend=this.extend;A.forEach=this.forEach;A.implement=this.implement;A.prototype=D;A.toString=this.toString;A.valueOf=function(G){return(G=="object")?A:C.valueOf()};F.call(A,E);if(typeof A.init=="function"){A.init()}return A};Base.prototype={extend:function(B,H){if(arguments.length>1){var E=this[B];if(E&&(typeof H=="function")&&(!E.valueOf||E.valueOf()!=H.valueOf())&&/\bbase\b/.test(H)){var A=H.valueOf();H=function(){var K=this.base||Base.prototype.base;this.base=E;var J=A.apply(this,arguments);this.base=K;return J};H.valueOf=function(J){return(J=="object")?H:A};H.toString=Base.toString}this[B]=H}else{if(B){var G=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){G=this.extend||G}var D={toSource:null};var F=["constructor","toString","valueOf"];var C=Base._prototyping?0:1;while(I=F[C++]){if(B[I]!=D[I]){G.call(this,I,B[I])}}for(var I in B){if(!D[I]){G.call(this,I,B[I])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(A,D,C){for(var B in A){if(this.prototype[B]===undefined){D.call(C,A[B],B,A)}}},implement:function(){for(var A=0;A<arguments.length;A++){if(typeof arguments[A]=="function"){arguments[A](this.prototype)}else{this.prototype.extend(arguments[A])}}return this},toString:function(){return String(this.valueOf())}});if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(window){Gitana=Base.extend({constructor:function(config){this.VERSION="0.1.0";Gitana.copyInto(this,config);if(!this.serverURL){this.serverURL="/proxy"}this.initXMLHttpClient=function(){var http=null;try{if(Gitana.isTitanium()){http=Titanium.Network.createHTTPClient()}else{http=new XMLHttpRequest()}}catch(e){var success=false;var XMLHTTP_IDS=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var i=0;i<XMLHTTP_IDS.length&&!success;i++){try{success=true;http=new ActiveXObject(XMLHTTP_IDS[i])}catch(e){}}if(!success){throw new Error("Unable to create XMLHttpRequest!")}}return http}},setLocale:function(locale){this.locale=locale},getLocale:function(){return this.locale},defaultFailureCallback:function(http){if(this.debug){if(!(typeof console==="undefined")){var message="Received bad http state ("+http.status+")";var stacktrace=null;var responseText=http.responseText;if(responseText){var json=JSON.parse(responseText);if(json.message){message=message+": "+json.message}}if(json.stacktrace){stacktrace=json.stacktrace}console.log(message);if(stacktrace){console.log(stacktrace)}}}},ajax:function(method,url,contentType,data,headers,successCallback,failureCallback){var _this=this;var http=this.initXMLHttpClient();if(method==null){method="get"}method=method.toLowerCase();var json=false;if(contentType=="application/json"){json=true}if((method=="post"||method=="put")&&(!contentType)){Gitana.debug("Performing method: "+method+" but missing content type");return }if(Gitana.isTitanium()){http.open(method.toUpperCase(),url,true)}else{http.open(method,url,true)}if(method=="get"){}else{if(method=="post"){http.setRequestHeader("Content-Type",contentType)}else{if(method=="put"){http.setRequestHeader("Content-Type",contentType)}else{if(method=="delete"){}}}}if(headers){for(key in headers){http.setRequestHeader(key,headers[key])}}http.onreadystatechange=function(){if(http.readyState==4){if(http.status==200){var result="";if(http.responseText){result=http.responseText}if(json){result=result.replace(/[\n\r]/g,"");result=eval("("+result+")")}if(successCallback&&Gitana.isFunction(successCallback)){successCallback(result)}}else{if(failureCallback&&Gitana.isFunction(failureCallback)){failureCallback(http)}}}};var toSend=data;if(json){if(data!=null){var d={};Gitana.copyInto(d,data);toSend=Gitana.stringify(d)}}http.send(toSend);return http},gitanaRequest:function(method,url,params,contentType,data,successCallback,failureCallback){if(Gitana.startsWith(url,"/")){url=this.serverURL+url}if(!failureCallback){failureCallback=this.defaultFailureCallback}var onSuccess=function(data){if(successCallback){var arg=data;if(contentType=="application/json"){arg=new Gitana.Response(data)}successCallback(arg)}};var onFailure=function(http){if(failureCallback){failureCallback(http)}};var headers={};if(this.ticket){headers.GITANA_TICKET=this.ticket}if(this.locale){headers["accept-language"]=this.locale}if(!params){params={}}params.metadata="true";params.full="true";if(this.ticket&&this.ticketAsParameter){params.ticket=this.ticket}var cacheBuster=new Date().getTime();params.cb=cacheBuster;for(var paramKey in params){var paramValue=params[paramKey];if(Gitana.isFunction(paramValue)){paramValue=paramValue.call()}else{if(Gitana.isString(paramValue)){}else{paramValue=escape(Gitana.stringify(paramValue,false))}}if(url.indexOf("?")>-1){url=url+"&"+paramKey+"="+paramValue}else{url=url+"?"+paramKey+"="+paramValue}}return this.ajax(method,url,contentType,data,headers,onSuccess,onFailure)},gitanaGet:function(url,params,successCallback,failureCallback){return this.gitanaRequest("GET",url,params,"application/json",null,successCallback,failureCallback)},gitanaDownload:function(url,params,successCallback,failureCallback){return this.gitanaRequest("GET",url,params,null,null,successCallback,failureCallback)},gitanaPost:function(url,params,jsonData,successCallback,failureCallback){return this.gitanaRequest("POST",url,params,"application/json",jsonData,successCallback,failureCallback)},gitanaUpload:function(url,params,contentType,data,successCallback,failureCallback){return this.gitanaRequest("POST",url,params,contentType,data,successCallback,failureCallback)},gitanaPut:function(url,params,jsonData,successCallback,failureCallback){return this.gitanaRequest("PUT",url,params,"application/json",jsonData,successCallback,failureCallback)},gitanaDelete:function(url,params,successCallback,failureCallback){return this.gitanaRequest("DELETE",url,params,"application/json",null,successCallback,failureCallback)},getFactory:function(){return new Gitana.ObjectFactory()},authenticate:function(username,password,authFailureHandler){var driver=this;var result=this.getFactory().server(this);return Chain(result).then(function(){var chain=this;driver.gitanaGet("/security/login",{u:username,p:password},function(response){driver.ticket=response.ticket;driver.authenticatedUsername=username;Gitana.writeCookie("GITANA_TICKET",response.ticket,"/");chain.next()},function(http){if(authFailureHandler){authFailureHandler.call(chain,http)}});return false})},clearAuthentication:function(){this.ticket=null;Gitana.deleteCookie("GITANA_TICKET","/")}});Gitana.EVERYONE={"principal-id":"EVERYONE","principal-type":"GROUP"};window.Gitana=Gitana})(window);(function(A){Chain=function(C){var B=function(){if(!Chain.idCount){Chain.idCount=0}return"chain-"+Chain.idCount++};if(!C){C={}}var D;D=Chain.proxy(C);D.queue=[];D.response=null;D.waiting=false;D.id=B();D.parent=null;D.then=function(H){var G=this;var F=false;if(Gitana.isArray(H)){var K=H;var E=function(){var P=0;var O=K.length;var Q=function(){P++;if(P==O){G.next()}};for(var M=0;M<K.length;M++){var N=K[M];var L=function(S){var R=Chain();R.waiting=true;R.subchain(G).then(function(){S.call(this)});R.then(function(){Q()});R.waiting=false;R.run()};L(N)}return false};var J=this.subchain(null,true);J.queue.push(E);H=J}else{if(Gitana.isFunction(H)){var J=this.subchain(null,true);J.queue.push(H);H=J;F=true}}this.queue.push(H);if(F&&!this.waiting){var I=this;while(I.parent){I=I.parent}if(!I.waiting){I.run()}}return this};D.run=function(){var F=this;if(this.queue.length==0||this.waiting){return this}this.waiting=true;var H=this.queue.shift();if(Gitana.isFunction(H)){var J=H;var E=null;var G=null;if(this.parent){E=this.parent.response;if(this.parent.parent){G=this.parent.parent.response}}A.setTimeout(function(){var K=J.call(F,E,G);if(K!==false){F.next(K)}},0)}else{var I=H;I.response=this.response;I.run()}return this};D.subchain=function(E,G){if(!E){E=this}var F=Chain(E);F.parent=this;if(!G){this.then(F)}return F};D.next=function(E){if(typeof E!=="undefined"){this.response=E}this.waiting=false;if(this.queue.length==0){if(this.parent){var F=this.response;this.parent.response=F;delete this.response;this.parent.next()}this.parent=null;this.queue=[]}else{this.run()}};D.wait=function(E){return this.then(function(){var F=function(G){return function(){G.next()}}(this);A.setTimeout(F,E);return false})};D.trap=function(E){this.errorHandler=E;return this};D.error=function(G){var E=null;var F=this;while(F&&!E){E=F.errorHandler;if(!E){F=F.parent}}this.queue=[];this.response=null;if(this.parent){this.parent.queue=[];this.parent.waiting=false}if(E){E.call(this,G);this.next()}};D.chain=function(){return Chain(this).then(function(){})};if(!D.clone){D.clone=function(){var E={};Gitana.copyInto(E,this);Chain(E);return E}}return D};Chain.proxy=function(D){if(D.original){D=Chain.unproxy(D)}function C(){}C.prototype=D;var B=new C();B.original=D;B.proxy=true;return B};Chain.unproxy=function(B){var C=null;if(B.original){C=B.original}return C}})(window);(function(B){var A=B.Gitana;A.Chainable=Base.extend({constructor:function(D){var C=this;this.base();this.getDriver=function(){return D};this.getFactory=function(){return new A.ObjectFactory()};this.httpError=function(E){var F=new Error();F.name="Http Error";F.message=JSON.parse(E.responseText).message;F.http=E;this.error(F);return false};this.missingNodeError=function(F){var E=new Error();E.name="Missing Node error";E.message="The node: "+F+" could not be found";this.error(E);return false};this.link=function(E){return this.subchain(E)};this.chainGet=function(E,G,H){var F=this;return this.link(E).then(function(){var I=this;if(A.isFunction(G)){G=G.call(F)}D.gitanaGet(G,H,function(J){I.handleResponse(J);I.next()},function(J){F.httpError(J)});return false})};this.chainCreate=function(E,G,H,I){var F=this;return this.link(E).then(function(){var J=this;if(A.isFunction(H)){H=H.call(F)}D.gitanaPost(H,I,G,function(K){D.gitanaGet(H+"/"+K.getId(),null,function(L){J.handleResponse(L);J.next()},function(L){F.httpError(L)})},function(K){F.httpError(K)});return false})};this.chainCreateEx=function(F,H,G,E){return this.link(F).then(function(){var I=this;D.gitanaPost(G,null,H,function(J){D.gitanaGet(E,null,function(K){I.handleResponse(K);I.next()},function(K){C.httpError(K)})},function(J){C.httpError(J)});return false})};this.chainPost=function(E,G,I,H){var F=this;return this.link(E).then(function(){var J=this;if(A.isFunction(G)){G=G.call(F)}D.gitanaPost(G,I,H,function(K){J.handleResponse(K);J.next()},function(K){F.httpError(K)});return false})};this.chainPostEmpty=function(E,G,I,H,J){var F=this;if(!H){H={}}return this.link(E).then(function(){var K=this;if(A.isFunction(G)){G=G.call(F)}D.gitanaPost(G,I,H,function(L){K.next()},function(L){F.httpError(L)});return false})};this.chainUpload=function(E,G,I,J,H){var F=this;if(!H){H={}}return this.link(E).then(function(){var K=this;if(A.isFunction(G)){G=G.call(F)}D.gitanaUpload(G,I,J,H,function(L){K.next()},function(L){F.httpError(L)});return false})};this.chainGetResponse=function(E,G,H){var F=this;return this.link(E).then(function(){var I=this;if(A.isFunction(G)){G=G.call(F)}D.gitanaGet(G,H,function(J){I.next(J)},function(J){F.httpError(J)});return false})};this.chainGetResponseRows=function(E,F,G){return this.chainGetResponse(E,F,G).then(function(){return this.response.rows})};this.chainHasResponseRow=function(E,F,G){return this.chainGetResponse(E,F).then(function(){var H=false;for(var I=0;I<this.response.rows.length;I++){if(this.response.rows[I].toLowerCase()==G.toLowerCase()){H=true}}return H})};this.extractPrincipalId=function(F){var E=null;if(A.isString(F)){E=F}else{if(F.getPrincipalId){E=F.getPrincipalId()}else{E=F["principal-id"]}}return E}}})})(window);(function(B){var A=B.Gitana;A.Response=Base.extend({constructor:function(C){A.copyInto(this,C)},getId:function(){return this["_doc"]},isStatusDocument:function(){return(this["ok"]||this["error"])},isListDocument:function(){return this["total_rows"]&&this["rows"]&&this["offset"]},isDataDocument:function(){return(!this.isStatusDocument()&&!this.isListDocument())},isOk:function(){var C=true;if(this.isStatusDocument()){if(this["ok"]!=null){C=this["ok"]}}if(this["error"]){C=false}return C},isError:function(){return !this.isOk()}})})(window);(function(B){var A=B.Gitana;A.SystemMetadata=Base.extend({constructor:function(){this.base();this._system={}},updateFrom:function(D){for(var C in this._system){if(this._system.hasOwnProperty(C)){delete this._system[C]}}A.copyInto(this._system,D)},get:function(C){return this._system[C]},getChangesetId:function(){return this.get("changeset")},getCreatedBy:function(){return this.get("created_by")},getModifiedBy:function(){return this.get("modified_by")},getCreatedOn:function(){if(!this.createdOn){this.createdOn=new A.Timestamp(this.get("created_on"))}return this.createdOn},getModifiedOn:function(){if(!this.modifiedOn){this.modifiedOn=new A.Timestamp(this.get("modified_on"))}return this.modifiedOn}})})(window);(function(B){var A=B.Gitana;A.Timestamp=Base.extend({constructor:function(C){this.base(C)},getYear:function(){return this["year"]},getMonth:function(){return this["month"]},getDay:function(){return this["day_of_month"]},getHour:function(){return this["hour"]},getMinute:function(){return this["minute"]},getSecond:function(){return this["second"]},getMillisecond:function(){return this["millisecond"]},getTime:function(){return this["ms"]},getTimestamp:function(){return this["timestamp"]}})})(window);(function(A){Gitana.uniqueIdCounter=0;Gitana.makeArray=function(B){return Array.prototype.slice.call(B)};Gitana.stringify=function(B,C){var D=null;if(C){D=JSON.stringify(B,null,"  ")}else{D=JSON.stringify(B)}return D};Gitana.isString=function(B){return(typeof B=="string")};Gitana.isBoolean=function(B){return(typeof B=="boolean")};Gitana.isFunction=function(B){return Object.prototype.toString.call(B)==="[object Function]"};Gitana.startsWith=function(C,B){return C.substr(0,B.length)===B};Gitana.copyInto=function(D,C){for(var B in C){if(C.hasOwnProperty(B)&&!this.isFunction(C[B])){D[B]=C[B]}}};Gitana.isArray=function(B){return B.push&&B.slice};Gitana.isUndefined=function(B){return(typeof B=="undefined")};Gitana.isEmpty=function(B){return this.isUndefined(B)||B==null};Gitana.generateId=function(){Gitana.uniqueIdCounter++;return"gitana-"+Gitana.uniqueIdCounter};Gitana.isNode=function(B){return(typeof Node==="object"?B instanceof Node:typeof B==="object"&&typeof B.nodeType==="number"&&typeof B.nodeName==="string")};Gitana.isElement=function(B){return(typeof HTMLElement==="object"?B instanceof HTMLElement:typeof B==="object"&&B.nodeType===1&&typeof B.nodeName==="string")};Gitana.debug=function(B){if(!this.isUndefined(console)){console.log(B)}};Gitana.error=function(B){if(!this.isUndefined(console)){console.error(B)}};Gitana.getNumberOfKeys=function(D){var C=0;for(var B in D){C++}return C};Gitana.isTitanium=function(){var B=true;if(typeof Titanium==="undefined"){B=false}return B};Gitana.writeCookie=function(D,C,B){if(typeof (document)!=="undefined"){if(!B){B="/"}document.cookie=D+"="+C+";expires=;path="+B}};Gitana.deleteCookie=function(C,B){if(typeof (document)!=="undefined"){document.cookie=C+"=;path="+B+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}}})(window);(function(B){var A=B.Gitana;A.ObjectFactory=Base.extend({constructor:function(){this.create=function(C,E,D){var F=new C(E,D);return F}},server:function(C){return this.create(A.Server,C)},auditRecord:function(D,C){return this.create(A.AuditRecord,D,C)},repository:function(D,C){return this.create(A.Repository,D,C)},changeset:function(D,C){return this.create(A.Changeset,D,C)},branch:function(D,C){return this.create(A.Branch,D,C)},node:function(F,D){var C=null;if(D){if(A.isString(D)){D={_type:D}}var E=D._type;if(E){if(A.ObjectFactory.registry[E]){C=A.ObjectFactory.registry[E]}}if(!C){if(E&&A.startsWith(E,"a:")){C=A.Association}}if(!C){if(D._is_association){C=A.Association}}}if(!C){C=A.Node}return this.create(C,F,D)},association:function(D,C){return this.create(A.Association,D,C)},securityUser:function(D,C){return this.create(A.SecurityUser,D,C)},securityGroup:function(D,C){return this.create(A.SecurityGroup,D,C)},definition:function(D,C){return this.create(A.Definition,D,C)},form:function(D,C){return this.create(A.Form,D,C)},auditRecordMap:function(D,C){return this.create(A.AuditRecordMap,D,C)},branchMap:function(D,C){return this.create(A.BranchMap,D,C)},changesetMap:function(D,C){return this.create(A.ChangesetMap,D,C)},nodeMap:function(D,C){return this.create(A.NodeMap,D,C)},principalMap:function(D,C){return this.create(A.PrincipalMap,D,C)},repositoryMap:function(D,C){return this.create(A.RepositoryMap,D,C)},traversalResults:function(D,C){return this.create(A.TraversalResults,D,C)}});A.ObjectFactory.registry={};A.ObjectFactory.register=function(D,C){A.ObjectFactory.registry[D]=C}})(window);(function(B){var A=B.Gitana;A.AbstractPersistable=A.Chainable.extend({constructor:function(D,C){this.base(D.getDriver());this.getServer=function(){return D};if(!this.object){this.object={}}if(C){this.handleResponse.call(this,C)}},handleResponse:function(C){for(var D in this.object){if(this.object.hasOwnProperty(D)&&!A.isFunction(this.object[D])){delete this.object[D]}}delete C._ref;A.copyInto(this.object,C);this.handleSystemProperties()},handleSystemProperties:function(){}})})(window);(function(B){var A=B.Gitana;A.AbstractMap=A.AbstractPersistable.extend({constructor:function(D,C){if(!this.map){this.map={}}if(!this.keys){this.keys=[]}this.base(D,C)},clear:function(){for(var C in this.map){if(this.map.hasOwnProperty(C)){delete this.map[C]}}while(this.keys.length>0){this.keys.shift()}},handleResponse:function(C){this.base(C);this.clear();if(C){if(A.isArray(C.rows)){for(var E=0;E<C.rows.length;E++){var G=this.buildObject(C.rows[E]);this.map[G.getId()]=G;this.keys.push(G.getId())}}else{for(var D in C.rows){var F=C.rows[D];var G=this.buildObject(F);this.map[G.getId()]=G;this.keys.push(G.getId())}}}},buildObject:function(C){},get:function(C){return this.map[C]},each:function(C){return this.then(function(){for(var E=0;E<this.keys.length;E++){var D=this.keys[E];var G=this.map[D];var F=function(J,I,H){return function(){J.call(this,I,this,H)}}(C,D,E);this.subchain(G).then(F)}return this})},eachX:function(C){return this.then(function(){var H=[];for(var E=0;E<this.keys.length;E++){var D=this.keys[E];var G=this.map[D];var F=function(L,J,K,I){return function(){this.subchain(K).then(function(){L.call(this,J,this,I)})}}(C,D,G,E);H.push(F)}return this.then(H)})},filter:function(C){return this.then(function(){var E=[];var D=[];for(var H=0;H<this.keys.length;H++){var G=this.keys[H];var F=this.map[G];var I=C.call(F);if(I){E.push(G)}else{D.push(G)}}for(var H=0;H<D.length;H++){delete this.map[D[H]]}while(this.keys.length>0){this.keys.shift()}for(var H=0;H<E.length;H++){this.keys.push(E[H])}})},sort:function(C){return this.then(function(){this.keys.sort(C)})},limit:function(C){return this.then(function(){var D=[];if(C>this.keys.length){return }for(var E=0;E<this.keys.length;E++){if(E>=C){D.push(this.keys[E])}}while(this.keys.length>C){this.keys.pop()}for(var E=0;E<D.length;E++){delete this.map[D[E]]}})},count:function(C){return this.then(function(){C.call(this,this.keys.length)})},keepOne:function(){var E=this;var D=this.buildObject({});var C=this.subchain(D);C.subchain(E).then(function(){if(this.keys.length>0){var G=this.map[this.keys[0]];if(C.loadFrom){C.loadFrom(G)}else{C.handleResponse(G.object)}}else{var F=new Error();F.name="Empty Map";F.message="The map doesn't have any elements in it";this.error(F)}});return C}})})(window);(function(B){var A=B.Gitana;A.AbstractObject=A.AbstractPersistable.extend({constructor:function(D,C){if(!this.system){this.system=new A.SystemMetadata()}this.chainDelete=function(E,G,H){var F=this;return this.link(E).then(function(){var I=this;if(A.isFunction(G)){G=G.call(F)}I.getDriver().gitanaDelete(G,H,function(){I.next()},function(J){F.httpError(J)});return false})};this.chainReload=function(E,G,H){var F=this;return this.link(E).then(function(){var I=this;if(A.isFunction(G)){G=G.call(F)}I.getDriver().gitanaGet(G,H,function(J){I.handleResponse(J);I.next()},function(J){F.httpError(J)});return false})};this.chainUpdate=function(E,G,H){var F=this;return this.link(E).then(function(){var I=this;if(A.isFunction(G)){G=G.call(F)}I.getDriver().gitanaPut(G,H,I.object,function(){I.getDriver().gitanaGet(G,H,function(J){I.handleResponse(J);I.next()},function(J){F.httpError(J)})},function(J){F.httpError(J)});return false})};this.base(D,C)},getUri:function(){return null},getDownloadUri:function(){return this.getDriver().serverURL+this.getUri()},get:function(C){return this.object[C]},set:function(C,D){this.object[C]=D},getId:function(){return this.get("_doc")},getSystemMetadata:function(){return this.system},getTitle:function(){return this.get("title")},getDescription:function(){return this.get("description")},replacePropertiesWith:function(C){var E={};A.copyInto(E,C);var F={};F._doc=this.object._doc;delete E._doc;F._type=this.object._type;delete E._type;F._qname=this.object._qname;delete E._qname;for(var D in this.object){if(this.object.hasOwnProperty(D)&&!A.isFunction(this.object[D])){delete this.object[D]}}this.object._doc=F._doc;this.object._type=F._type;this.object._qname=F._qname;A.copyInto(this.object,E)},handleSystemProperties:function(){if(this.object){if(this.object._system){var C={};A.copyInto(C,this.object._system);delete this.object._system;this.system.updateFrom(C)}}},stringify:function(C){return A.stringify(this.object,C)},loadFrom:function(C){this.handleResponse(C.object);this.system.updateFrom(C.system._system)}})})(window);(function(B){var A=B.Gitana;A.AbstractNode=A.AbstractObject.extend({constructor:function(D,C){this.base(D.getServer(),C);this.getRepository=function(){return D.getRepository()};this.getRepositoryId=function(){return D.getRepository().getId()};this.getBranch=function(){return D};this.getBranchId=function(){return D.getId()}},getUri:function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()},clone:function(){return this.getFactory().node(this.getBranch(),this.object)},stats:function(){var C=this.get("stats");if(!C){C={}}return C},reload:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()};return this.chainReload(this.clone(),C)},update:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()};return this.chainUpdate(this.clone(),C)},del:function(D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()};return this.chainDelete(this.getBranch(),C)},getFeatureIds:function(){var C=[];if(this.get("_features")){for(var D in this.get("_features")){C[C.length]=D}}return C},getFeature:function(D){var C=null;if(this.get("_features")){C=this.get("_features")[D]}return C},removeFeature:function(C){if(this.get("_features")){if(this.get("_features")[C]){delete this.get("_features")[C]}}},addFeature:function(D,C){if(!this.get("_features")){this.set("_features",{})}this.get("_features")[D]=C},hasFeature:function(D){var C=false;if(this.get("_features")){C=this.get("_features")[D]}return C},getQName:function(){return this.get("_qname")},getTypeQName:function(){return this.get("_type")},isAssociation:function(){return false},isContainer:function(){return this.hasFeature("f:container")}})})(window);(function(B){var A=B.Gitana;A.Association=A.AbstractNode.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Association"},isAssociation:function(){return true},getDirectionality:function(){return this.get("directionality")},getSourceNodeId:function(){return this.get("source")},getSourceNodeChangesetId:function(){return this.get("source_changeset")},getSourceNodeType:function(){return this.get("source_type")},getTargetNodeId:function(){return this.get("target")},getTargetNodeChangesetId:function(){return this.get("target_changeset")},getTargetNodeType:function(){return this.get("target_type")},readSourceNode:function(){var D=this;var C=this.getFactory().node(this.getBranch());return this.subchain(C).then(function(){var E=this;this.subchain(D.getBranch()).readNode(D.getSourceNodeId()).then(function(){C.loadFrom(this)})})},readTargetNode:function(){var D=this;var C=this.getFactory().node(this.getBranch());return this.subchain(C).then(function(){var E=this;this.subchain(D.getBranch()).readNode(D.getTargetNodeId()).then(function(){C.loadFrom(this)})})},readOtherNode:function(E){var D=this;var F=null;if(A.isString(E)){F=E}else{F=E.getId()}var C=this.subchain(this.getFactory().node(this.getBranch()));C.subchain(D).then(function(){if(F==this.getSourceNodeId()){this.readTargetNode().then(function(){C.loadFrom(this)})}else{if(F==this.getTargetNodeId()){this.readSourceNode().then(function(){C.loadFrom(this)})}else{var G=new Error();G.name="No node on association";G.message="The node: "+F+" was not found on this association";this.error(G);return false}}});return C},getDirection:function(C){var E=null;if(A.isString(C)){E=C}else{E=C.getId()}var D=null;if(this.getDirectionality()=="UNDIRECTED"){D="MUTUAL"}else{if(this.getSourceNodeId()==E){D="OUTGOING"}else{if(this.getTargetNodeId()==E){D="INCOMING"}}}return D},getOtherNodeId:function(D){var E=null;if(A.isString(D)){E=D}else{E=D.getId()}var C=null;if(this.getSourceNodeId()==E){C=this.getTargetNodeId()}else{if(this.getTargetNodeId()==E){C=this.getSourceNodeId()}}return C}})})(window);(function(B){var A=B.Gitana;A.AuditRecord=A.AbstractObject.extend({constructor:function(D,C){this.base(D.getServer(),C);this.persistable=D;this.objectType="Gitana.AuditRecord"},getUri:function(){return this.persistable.getUri()+"/audit"},clone:function(){return this.getFactory().auditRecord(this.getServer(),this.object)},getScope:function(){return this.get("scope")},getAction:function(){return this.get("action")},getPrincipalId:function(){return this.get("principal")},getMethod:function(){return this.get("method")},getHandler:function(){return this.get("handler")},getArgs:function(){return this.get("args")},getReturn:function(){return this.get("return")}})})(window);(function(B){var A=B.Gitana;A.Branch=A.AbstractObject.extend({constructor:function(D,C){this.base(D.getServer(),C);this.objectType="Gitana.Branch";this.getRepository=function(){return D};this.getRepositoryId=function(){return D.getId()}},getUri:function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()},clone:function(){return this.getFactory().branch(this.getRepository(),this.object)},isMaster:function(){return(this.getType().toLowerCase()=="master")},getType:function(){return this.get("type")},reload:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()};return this.chainReload(this.clone(),C)},update:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()};return this.chainUpdate(this.clone(),C)},del:function(){return this.subchain(this.getRepository()).then(function(){})},loadACL:function(D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/acl"};return this.chainGetResponse(this,C).then(function(){D.call(this,this.response)})},listAuthorities:function(E,F){var D=this.extractPrincipalId(E);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/acl/"+D};return this.chainGetResponseRows(this,C).then(function(){F.call(this,this.response)})},checkAuthority:function(F,D,G){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/acl/"+E};return this.chainHasResponseRow(this,C,D).then(function(){G.call(this,this.response)})},grantAuthority:function(F,D){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/acl/"+E+"/grant/"+D};return this.chainPostEmpty(this,C)},revokeAuthority:function(F,D){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/acl/"+E+"/revoke/"+D};return this.chainPostEmpty(this,C)},revokeAllAuthorities:function(C){return this.revokeAuthority(C,"all")},listMounts:function(D){var F={};if(D){A.copyInto(F,D)}var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes"};var C=this.getFactory().nodeMap(this);return this.chainGet(C,E,F)},readNode:function(E){var D=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes/"+E};var C=this.getFactory().node(this);return this.chainGet(C,D)},createNode:function(D){var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes"};var C=this.getFactory().node(this);return this.chainCreate(C,D,E)},searchNodes:function(F,D){var G={};if(D){A.copyInto(G,D)}if(A.isString(F)){F={search:F}}var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes/search"};var C=this.getFactory().nodeMap(this);return this.chainPost(C,E,G,F)},queryNodes:function(F,D){var G={};if(D){A.copyInto(G,D)}var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes/query"};var C=this.getFactory().nodeMap(this);return this.chainPost(C,E,G,F)},readPerson:function(F,D){var E=function(){var G="/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/person/"+F;if(D){G+="?createIfNotFound="+D}return G};var C=this.getFactory().node(this,"n:person");return this.chainGet(C,E)},readGroup:function(F,D){var E=function(){var G="/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/group/"+F;if(D){G+="?createIfNotFound="+D}return G};var C=this.getFactory().node(this,"n:group");return this.chainGet(C,E)},listDefinitions:function(E){var D=function(){var F="/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/definitions";if(E){F=F+"?filter="+E}return F};var C=this.getFactory().nodeMap(this);return this.chainGet(C,D)},readDefinition:function(E){var D=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/definitions/"+E};var C=this.getFactory().definition(this);return this.chainGet(C,D)},generateQName:function(D,E){var C=this;return this.then(function(){var F=this;var G="/repositories/"+C.getRepositoryId()+"/branches/"+C.getId()+"/qnames/generate";C.getDriver().gitanaPost(G,null,D,function(H){var I=H._qname;E.call(F,I);F.next()});return false})},associate:function(F,G,D){var E=null;if(A.isString(F)){E=F}else{E=F.getId()}var H=null;if(A.isString(G)){H=G}else{H=G.getId()}var C=this.subchain(this);C.subchain(this).then(function(){this.readNode(E).associate(H,D)});return C},traverse:function(D,C){var E=null;if(A.isString(D)){E=D}else{E=D.getId()}return this.readNode(E).traverse(C)},createContainer:function(C){if(!C){C={}}if(!C._system){C._system={}}if(!C._system["_features"]){C._system["_features"]={}}C._system["_features"]["f:container"]={active:"true"};return this.createNode(C)},find:function(E,D){var G={};if(D){A.copyInto(G,D)}var F=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getId()+"/nodes/find"};var C=this.getFactory().nodeMap(this);return this.chainPost(C,F,G,E)}})})(window);(function(B){var A=B.Gitana;A.Changeset=A.AbstractObject.extend({constructor:function(D,C){this.base(D.getServer(),C);this.objectType="Gitana.Changeset";this.getRepository=function(){return D};this.getRepositoryId=function(){return D.getId()};this.getServer=function(){return D.getServer()}},getUri:function(){return"/repositories/"+this.getRepositoryId()+"/changesets/"+this.getId()},clone:function(){return this.getFactory().changeset(this.getRepository(),this.object)},reload:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/changesets/"+this.getId()};return this.chainReload(this.clone(),C)},update:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/changesets/"+this.getId()};return this.chainUpdate(this.clone(),C)},del:function(){var C=this.subchain(this.getRepository());return this.subchain(C).then(function(){})}})})(window);(function(B){var A=B.Gitana;A.Node=A.AbstractNode.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Node"},listChildren:function(D){var F={};if(D){A.copyInto(F,D)}var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/children"};var C=this.getFactory().nodeMap(this.getBranch());return this.chainGet(C,E,F)},associations:function(E,D){var G=null;var H=null;if(E){G=E.type;H=E.direction.toUpperCase()}var I={};if(D){A.copyInto(I,D)}var F=function(){var J="/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/associations?a=1";if(G){J=J+"&type="+G}if(H){J=J+"&direction="+H}return J};var C=this.getFactory().nodeMap(this.getBranch());return this.chainGet(C,F,I)},incomingAssociations:function(E,C){var D={direction:"INCOMING"};if(E){D.type=E}return this.associations(D,C)},outgoingAssociations:function(E,C){var D={direction:"OUTGOING"};if(E){D.type=E}return this.associations(D,C)},associate:function(F,D,C){if(!A.isString(F)){F=F.getId()}if(D){if(A.isString(D)){D={_type:D}}}var E=function(){var G="/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/associate?node="+F;if(C){G+="&directionality=UNDIRECTED"}return G};return this.chainPostEmpty(this,E,null,D)},associateOf:function(G,F,E){var D=this;var C=this.subchain(this);C.subchain(G).then(function(){this.associate(D,F,E)});return C},unassociate:function(F,E,C){if(!A.isString(F)){F=F.getId()}var D=function(){var G="/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/unassociate?node="+F;if(E){G=G+"&type="+E}if(C){G+="&directionality=UNDIRECTED"}return G};return this.chainPostEmpty(this,D)},traverse:function(D){var H=this;var F={traverse:D};var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/traverse"};var C=this.getFactory().traversalResults(this.getBranch());var G={};return this.chainPost(C,E,G,F)},mount:function(D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/mount/"+D};return this.chainPostEmpty(this,C,null,object)},unmount:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/unmount"};return this.chainPostEmpty(this,C,null,object)},lock:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/lock"};return this.chainPostEmpty(this,C)},unlock:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/unlock"};return this.chainPostEmpty(this,C)},checkLocked:function(C){return this.subchain(this).then(function(){var D=this;var E="/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/lock";this.getDriver().gitanaGet(E,null,function(F){C.call(D,F.locked);D.next()});return false})},loadACL:function(){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/acl"};return this.chainGetResponse(this,C)},listAuthorities:function(E){var D=this.extractPrincipalId(E);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/acl/"+D};return this.chainGetResponseRows(this,C)},checkAuthority:function(F,D){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/acl/"+E};return this.chainHasResponseRow(this,C,D)},grantAuthority:function(F,D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/acl/"+E+"/grant/"+D};var E=this.extractPrincipalId(F);return this.chainPostEmpty(this,C)},revokeAuthority:function(F,D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/acl/"+E+"/revoke/"+D};var E=this.extractPrincipalId(F);return this.chainPostEmpty(this,C)},revokeAllAuthorities:function(C){return this.revokeAuthority(C,"all")},listAuditRecords:function(D){var F={};if(D){A.copyInto(F,D)}var E=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/auditrecords"};var C=this.getFactory().auditRecordMap(this);return this.chainGet(C,E,F)},createTranslation:function(G,C,E){var F=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/i18n?edition="+G+"&locale="+C};var D=this.getFactory().node(this.getBranch());return this.chainCreate(D,E,F)},editions:function(D){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/i18n/editions"};return this.chainGetResponse(this,C).then(function(){D.call(this,this.response.editions)})},locales:function(D,E){var C=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/i18n/locales?edition="+D};return this.chainGetResponse(this,C).then(function(){E.call(this,this.response.locales)})},readTranslation:function(){var G;var C;var E=A.makeArray(arguments);if(E.length==1){C=E.shift()}else{if(E.length>1){G=E.shift();C=E.shift()}}var F=function(){var H="/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/i18n?locale="+C;if(G){H+="&edition="+G}return H};var D=this.getFactory().node(this.getBranch());return this.chainGet(D,F)},listAttachments:function(){var E=this;var D=new A.NodeAttachmentMap(this);var C=this.subchain(D);C.subchain().then(function(){var F=this;E.getDriver().gitanaGet(E.getUri()+"/attachments",null,function(G){var I={};for(var H=0;H<G.rows.length;H++){I[G.rows[H]["_doc"]]=G.rows[H]}D.handleMap(I);F.next()});return false});return C},attachment:function(C){return this.listAttachments().select(C)},attach:function(F,G,E){var D=this;if(!F){F="default"}var C=this.subchain(new A.NodeAttachment(this,F));C.subchain().then(function(){var H=D.getUri()+"/attachments/"+F;this.chainUpload(this,H,null,G,E).then(function(){this.subchain(D).listAttachments().select(F).then(function(){C.handleAttachment(this.attachment)})})});return C},unattach:function(C){return this.subchain().then(function(){this.chainDelete(this,this.getUri()+"/attachments/"+C).then(function(){})})},createChild:function(C){return this.subchain(this.getBranch()).createNode(C).childOf(this)},childOf:function(C){return this.associateOf(C,"a:child")},find:function(E,D){var G={};if(D){A.copyInto(G,D)}var F=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/find"};var C=this.getFactory().nodeMap(this.getBranch());return this.chainPost(C,F,G,E)}})})(window);(function(B){var A=B.Gitana;A.Principal=A.AbstractObject.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Principal"},getPrincipalId:function(){return this.get("principal-id")},getPrincipalType:function(){return this.get("principal-type")},listMemberships:function(E){var F=this;var D="/security/"+this.getPrincipalType().toLowerCase()+"s/"+F.getPrincipalId()+"/memberships";if(E){D=D+"?indirect=true"}var C=this.getFactory().principalMap(this.getServer());return this.chainGet(C,D)},listAttachments:function(){var E=this;var D=new A.BinaryAttachmentMap(this);var C=this.subchain(D);C.subchain().then(function(){var F=this;E.getDriver().gitanaGet(E.getUri()+"/attachments",null,function(G){var I={};for(var H=0;H<G.rows.length;H++){I[G.rows[H]["_doc"]]=G.rows[H]}D.handleMap(I);F.next()});return false});return C},attachment:function(C){return this.listAttachments().select(C)},attach:function(F,G,E){var D=this;var C=this.subchain(new A.BinaryAttachment(this,F));C.subchain().then(function(){var H=D.getUri()+"/attachments/"+F;this.chainUpload(this,H,null,G,E).then(function(){this.subchain(D).listAttachments().select(F).then(function(){C.handleAttachment(this.attachment)})})});return C},unattach:function(C){return this.subchain().then(function(){this.chainDelete(this,this.getUri()+"/attachments/"+C).then(function(){})})}})})(window);(function(B){var A=B.Gitana;A.Repository=A.AbstractObject.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Repository"},getUri:function(){return"/repositories/"+this.getId()},clone:function(){return this.getFactory().repository(this.getServer(),this.object)},del:function(){var C=function(){return"/repositories/"+this.getId()};return this.chainDelete(this.getServer(),C)},reload:function(){var C=function(){return"/repositories/"+this.getId()};return this.chainReload(this.clone(),C)},update:function(){var C=function(){return"/repositories/"+this.getId()};return this.chainUpdate(this.clone(),C)},listBranches:function(D){var F={};if(D){A.copyInto(F,D)}var E=function(){return"/repositories/"+this.getId()+"/branches"};var C=this.getFactory().branchMap(this);return this.chainGet(C,E,F)},readBranch:function(E){var D=function(){return"/repositories/"+this.getId()+"/branches/"+E};var C=this.getFactory().branch(this);return this.chainGet(C,D)},createBranch:function(F,D){var E=function(){return"/repositories/"+this.getId()+"/branches"};var G={changeset:F};var C=this.getFactory().branch(this);return this.chainCreate(C,D,E,G)},queryBranches:function(F,D){var G={};if(D){A.copyInto(G,D)}var E=function(){return"/repositories/"+this.getId()+"/branches/query"};var C=this.getFactory().branchMap(this);return this.chainPost(C,E,G,F)},listChangesets:function(){var D=function(){return"/repositories/"+this.getId()+"/changesets"};var C=this.getFactory().changesetMap(this);return this.chainGet(C,D)},readChangeset:function(E){var D=function(){return"/repositories/"+this.getId()+"/changesets/"+E};var C=this.getFactory().changeset(this);return this.chainGet(C,D)},listChangesetParents:function(E){var D=function(){return"/repositories/"+this.getId()+"/changesets/"+E+"/parents"};var C=this.getFactory().changesetMap(this);return this.chainGet(C,D)},listChangesetChildren:function(E){var D=function(){return"/repositories/"+this.getId()+"/changesets/"+E+"/children"};var C=this.getFactory().changesetMap(this);return this.chainGet(C,D)},loadACL:function(D){var C=function(){return"/repositories/"+this.getId()+"/acl"};return this.chainGetResponse(this,C).then(function(){D.call(this,this.response)})},listAuthorities:function(E,F){var D=this.extractPrincipalId(E);var C=function(){return"/repositories/"+this.getId()+"/acl/"+D};return this.chainGetResponseRows(this,C).then(function(){F.call(this,this.response)})},checkAuthority:function(F,D,G){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getId()+"/acl/"+E};return this.chainHasResponseRow(this,C,D).then(function(){G.call(this,this.response)})},grantAuthority:function(F,D){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getId()+"/acl/"+E+"/grant/"+D};return this.chainPostEmpty(this,C)},revokeAuthority:function(F,D){var E=this.extractPrincipalId(F);var C=function(){return"/repositories/"+this.getId()+"/acl/"+E+"/revoke/"+D};return this.chainPostEmpty(this,C)},revokeAllAuthorities:function(C){return this.revokeAuthority(C,"all")},getMaxSize:function(){return this.get("maxSize")},getSize:function(){return this.get("size")},getObjectCount:function(){return this.get("objectcount")}})})(window);(function(B){var A=B.Gitana;A.SecurityGroup=A.Principal.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.SecurityGroup"},getUri:function(){return"/security/groups/"+this.getId()},clone:function(){return this.getFactory().securityGroup(this.getServer(),this.object)},del:function(){return this.chainDelete(this.getServer(),"/security/groups/"+this.getId())},reload:function(){return this.chainReload(this.clone(),"/security/groups/"+this.getId())},update:function(){return this.chainUpdate(this.clone(),"/security/groups/"+this.getId())},listMembers:function(G,H,D){var E=this;var I={};if(D){A.copyInto(I,D)}I.filter=G;if(H){I.indirect=true}var F=function(){return"/security/groups/"+E.getPrincipalId()+"/members"};var C=this.getFactory().principalMap(this.getServer());return this.chainGet(C,F,I)},listUsers:function(){var F=false;var D=null;var E=A.makeArray(arguments);var C=E.shift();if(A.isBoolean(C)){F=C;D=E.shift()}else{D=E.shift()}return this.listMembers("user",F,D)},listGroups:function(){var F=false;var D=null;var E=A.makeArray(arguments);var C=E.shift();if(A.isBoolean(C)){F=C;D=E.shift()}else{D=E.shift()}return this.listMembers("group",F,D)},addMember:function(D){var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/security/groups/"+this.getId()+"/add/"+C)},removeMember:function(D){var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/security/groups/"+this.getId()+"/remove/"+C)}})})(window);(function(B){var A=B.Gitana;A.SecurityUser=A.Principal.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.SecurityUser"},getUri:function(){return"/security/users/"+this.getId()},clone:function(){return this.getFactory().securityUser(this.getServer(),this.object)},del:function(){return this.chainDelete(this.getServer(),"/security/users/"+this.getId())},reload:function(){return this.chainReload(this.clone(),"/security/users/"+this.getId())},update:function(){return this.chainUpdate(this.clone(),"/security/users/"+this.getId())},readPerson:function(E,D){var C=this.subchain(this.getFactory().node(E,"n:person"));C.subchain(E).readPerson(this.getPrincipalId(),D).then(function(){C.handleResponse(this.object)});return C},getFirstName:function(){return this.get("firstName")},setFirstName:function(C){this.set("firstName",C)},getLastName:function(){return this.get("lastName")},setLastName:function(C){this.set("lastName",C)},getCompanyName:function(){return this.get("companyName")},setCompanyName:function(C){this.set("companyName",C)},getEmail:function(){return this.get("email")},setEmail:function(C){this.set("email",C)}})})(window);(function(A){Gitana=A.Gitana;Gitana.Server=Gitana.Chainable.extend({constructor:function(B){this.base(B);this.objectType="Gitana.Server"},getUri:function(){return"/"},clone:function(){return this.getFactory().server(this.getDriver())},loadACL:function(B){return this.chainGetResponse(this,"/acl").then(function(){B.call(this,this.response)})},listAuthorities:function(C,D){var B=this.extractPrincipalId(C);return this.chainGetResponseRows(this,"/acl/"+B).then(function(){D.call(this,this.response)})},checkAuthority:function(D,B,E){var C=this.extractPrincipalId(D);return this.chainHasResponseRow(this,"/acl/"+C,B).then(function(){E.call(this,this.response)})},grantAuthority:function(D,B){var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/acl/"+C+"/grant/"+B)},revokeAuthority:function(D,B){var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/acl/"+C+"/revoke/"+B)},revokeAllAuthorities:function(B){return this.revokeAuthority(B,"all")},listGroups:function(){var F=Gitana.makeArray(arguments);var H=null;var E=null;var D=F.shift();if(D){if(D.objectType=="Gitana.SecurityGroup"){H=D;E=F.shift()}else{E=D}}var I={};if(E){Gitana.copyInto(I,E)}var C=this.getFactory().principalMap(this);if(!H){return this.chainGet(C,"/security/groups",I)}else{var B=this.subchain(C);var G=this.extractPrincipalId(H);B.subchain(this).readGroup(G).listGroups(I).then(function(){B.handleResponse(this.object)});return B}},readGroup:function(C){var B=this.getFactory().securityGroup(this);return this.chainGet(B,"/security/groups/"+C)},createGroup:function(D,C){if(!C){C={}}C["principal-id"]=D;C["principal-type"]="group";var B=this.getFactory().securityGroup(this);return this.chainCreateEx(B,C,"/security/groups","/security/groups/"+D)},listUsers:function(){var F=Gitana.makeArray(arguments);var H=null;var E=null;var D=F.shift();if(D){if(D.objectType=="Gitana.SecurityGroup"){H=D;E=F.shift()}else{E=D}}var I={};if(E){Gitana.copyInto(I,E)}var C=this.getFactory().principalMap(this);if(!H){return this.chainGet(C,"/security/users",I)}else{var B=this.subchain(C);var G=this.extractPrincipalId(H);B.subchain(this).readGroup(G).listUsers(I).then(function(){B.handleResponse(this.object)});return B}},readUser:function(C){var B=this.getFactory().securityUser(this);return this.chainGet(B,"/security/users/"+C)},createUser:function(E,D){var C=this;if(!D){D={}}D["principal-id"]=E;D["principal-type"]="user";var B=this.getFactory().securityUser(this);return this.chainCreateEx(B,D,"/security/users","/security/users/"+E)},listRepositories:function(C){var D={};if(C){Gitana.copyInto(D,C)}var B=this.getFactory().repositoryMap(this);return this.chainGet(B,"/repositories",D)},readRepository:function(C){var B=this.getFactory().repository(this);return this.chainGet(B,"/repositories/"+C)},createRepository:function(C){var B=this.getFactory().repository(this);return this.chainCreate(B,C,"/repositories")},queryRepositories:function(D,C){var B=this.getFactory().repositoryMap(this);var E={};if(C){Gitana.copyInto(E,C)}return this.chainPost(B,"/repositories/query",E,D)},addMember:function(E,D){var B=this.extractPrincipalId(E);var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/security/groups/"+B+"/add/"+C)},removeMember:function(E,D){var B=this.extractPrincipalId(E);var C=this.extractPrincipalId(D);return this.chainPostEmpty(this,"/security/groups/"+B+"/remove/"+C)},authenticate:function(D,C,B){return this.getDriver().authenticate(D,C,B)},logout:function(){var C=this;var B=this.subchain(this);B.subchain().then(function(){C.getDriver().clearAuthentication()});return B}});Gitana.EVERYONE={"principal-id":"EVERYONE","principal-type":"GROUP"}})(window);(function(B){var A=B.Gitana;A.AuditRecordMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.AuditRecordMap";this.persistable=D;this.base(D.getServer(),C)},clone:function(){return this.getFactory().auditRecordMap(this.persistable,this.object)},buildObject:function(C){return this.getFactory().auditRecord(this.persistable,C)}})})(window);(function(B){var A=B.Gitana;A.BranchMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.BranchMap";this.getRepository=function(){return D};this.getRepositoryId=function(){return D.getId()};this.base(D.getServer(),C)},clone:function(){return this.getFactory().branchMap(this.getRepository(),this.object)},buildObject:function(C){return this.getFactory().branch(this.getRepository(),C)}})})(window);(function(B){var A=B.Gitana;A.ChangesetMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.ChangesetMap";this.getRepository=function(){return D};this.getRepositoryId=function(){return D.getId()};this.base(D.getServer(),C)},clone:function(){return this.getFactory().changesetMap(this.getRepository(),this.object)},buildObject:function(C){return this.getFactory().changeset(this.getRepository(),C)}})})(window);(function(B){var A=B.Gitana;A.NodeMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.NodeMap";this.getRepository=function(){return D.getRepository()};this.getRepositoryId=function(){return D.getRepository().getId()};this.getBranch=function(){return D};this.getBranchId=function(){return D.getId()};this.base(D.getServer(),C)},clone:function(){return this.getFactory().nodeMap(this.getBranch(),this.object)},buildObject:function(C){return this.getFactory().node(this.getBranch(),C)}})})(window);(function(B){var A=B.Gitana;A.PrincipalMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.PrincipalMap";this.base(D,C)},clone:function(){return this.getFactory().principalMap(this.getServer(),this.object)},buildObject:function(C){var E=null;var D=C["principal-type"];if(D){D=D.toLowerCase();if(D=="user"){E=this.getFactory().securityUser(this.getServer(),C)}else{if(D=="group"){E=this.getFactory().securityGroup(this.getServer(),C)}}}return E}})})(window);(function(B){var A=B.Gitana;A.RepositoryMap=A.AbstractMap.extend({constructor:function(D,C){this.objectType="Gitana.RepositoryMap";this.base(D,C)},clone:function(){return this.getFactory().repositoryMap(this.getServer(),this.object)},buildObject:function(C){return this.getFactory().repository(this.getServer(),C)}})})(window);(function(B){var A=B.Gitana;A.Definition=A.Node.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Definition"},listFormAssociations:function(){var D=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/forms"};var C=this.getFactory().nodeMap(this.getBranch());return this.chainGet(C,D)},readForm:function(E){var D=function(){return"/repositories/"+this.getRepositoryId()+"/branches/"+this.getBranchId()+"/nodes/"+this.getId()+"/forms/"+E};var C=this.getFactory().form(this.getBranch());return this.chainGet(C,D)},createForm:function(F,G){var E=this;if(!G){G={}}G._type="n:form";var D=this.getFactory().form(this.getBranch());var C=this.subchain(D);C.subchain(this.getBranch()).createNode(G).then(function(){var H=this;this.subchain(E).then(function(){var I={_type:"a:has_form","form-key":F};this.associate(H,I).then(function(){var J=this;var K="/repositories/"+H.getRepositoryId()+"/branches/"+H.getBranchId()+"/nodes/"+H.getId();this.getDriver().gitanaGet(K,null,function(L){C.handleResponse(L);J.next()});return false})})});return C},removeFormAssociation:function(C){return this.link(this).then(function(){var D=null;this.listFormAssociations().each(function(){if(this.getFormKey()==C){D=this}}).then(function(){if(D){this.subchain(D).del()}})})}});A.ObjectFactory.register("d:type",A.Definition);A.ObjectFactory.register("d:feature",A.Definition);A.ObjectFactory.register("d:association",A.Definition)})(window);(function(B){var A=B.Gitana;A.Form=A.Node.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Form"},getEngineId:function(){return this.get("engineId")},setEngineId:function(C){this.set("engineId",C)}});A.ObjectFactory.register("n:form",A.Form)})(window);(function(B){var A=B.Gitana;A.HasFormAssociation=A.Association.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.HasFormAssociation"},getFormKey:function(){return this.get("form-key")},setFormKey:function(C){this.set("form-key",C)}});A.ObjectFactory.register("a:has_form",A.HasFormAssociation)})(window);(function(B){var A=B.Gitana;A.HasTranslationAssociation=A.Association.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.HasTranslationAssociation"},getLocale:function(){return this.get("locale")},setLocale:function(C){this.set("locale",C)},getEdition:function(){return this.get("edition")},setEdition:function(C){this.set("edition",C)}});A.ObjectFactory.register("a:has_translation",A.HasTranslationAssociation)})(window);(function(B){var A=B.Gitana;A.Person=A.Node.extend({constructor:function(D,C){this.base(D,C);this.objectType="Gitana.Person"},getPrincipalId:function(){return this.get("principal-id")},readUser:function(){var C=this.subchain(this.getFactory().securityUser(this.getServer()));C.subchain(this.getServer()).readUser(this.getPrincipalId()).then(function(){C.handleResponse(this.object)});return C}});A.ObjectFactory.register("n:person",A.Person)})(window);(function(B){var A=B.Gitana;A.TraversalResults=A.AbstractPersistable.extend({constructor:function(D,C){if(!this._nodes){this._nodes={}}if(!this._associations){this._associations={}}if(!this._config){this._config={}}this.base(D.getServer(),C);this.getRepository=function(){return D.getRepository()};this.getRepositoryId=function(){return D.getRepository().getId()};this.getBranch=function(){return D};this.getBranchId=function(){return D.getId()}},clear:function(){for(var C in this._nodes){if(this._nodes.hasOwnProperty(C)){delete this._nodes[C]}}for(var C in this._associations){if(this._associations.hasOwnProperty(C)){delete this._associations[C]}}for(var C in this._config){if(this._config.hasOwnProperty(C)){delete this._config[C]}}},handleResponse:function(C){this.base(C);this.clear();A.copyInto(this._nodes,C.nodes);A.copyInto(this._associations,C.associations);A.copyInto(this._config,C.config);this._config.center=C.node},center:function(){var D=this.getFactory().node(this.getBranch());var C=this.subchain(D);C.subchain(this.getBranch()).readNode(this._config.center).then(function(){C.handleResponse(this.object)});return C},nodeCount:function(C){return this.then(function(){C.call(this,A.getNumberOfKeys(this._nodes))})},associationCount:function(C){return this.then(function(){C.call(this,A.getNumberOfKeys(this._associations))})},nodes:function(){var D=this;var C=this.subchain(this.getFactory().nodeMap(this.getBranch()));C.subchain().then(function(){var E={rows:D._nodes};C.handleResponse(E)});return C},node:function(E){var D=this;var C=this.subchain(this.getFactory().node(this.getBranch()));C.subchain(D).then(function(){this.nodes().then(function(){var F=this.get(E);if(F){C.handleResponse(F.object)}else{return D.missingNodeError(E)}})});return C},associations:function(){var D=this;var C=this.subchain(this.getFactory().nodeMap(this.getBranch()));C.subchain().then(function(){var E={rows:D._associations};C.handleResponse(E)});return C},association:function(E){var D=this;var C=this.subchain(this.getFactory().association(this.getBranch()));C.subchain().then(function(){this.associations().then(function(){var F=this.get(E);if(F){C.handleResponse(F.object)}else{return D.missingNodeError(E)}})});return C}})})(window);(function(B){var A=B.Gitana;A.BinaryAttachment=A.Chainable.extend({constructor:function(D,C,E){this.base(D.getDriver());this.objectType="Gitana.BinaryAttachment";this.persistable=D;this.attachmentId=C;this.attachment={};this.handleAttachment(E)},handleAttachment:function(D){for(var C in this.attachment){if(this.attachment.hasOwnProperty(C)){delete this.attachment[C]}}if(D){A.copyInto(this.attachment,D)}},getId:function(){return this.attachmentId},getLength:function(){return this.attachment.length},getContentType:function(){return this.attachment.contentType},getUri:function(){return this.persistable.getUri()+"/attachments/"+this.getId()},getDownloadUri:function(){return this.getDriver().serverURL+this.getUri()},del:function(){var D=this;var C=this.subchain(this.persistable);C.subchain(D).then(function(){var E=this;this.getDriver().gitanaDelete(this.getUri(),null,function(){E.next()},function(F){D.httpError(F)});return false});return C},download:function(D){var C=this;return this.then(function(){var E=this;this.getDriver().gitanaDownload(this.getUri(),null,function(F){D.call(C,F);E.next()},function(F){C.httpError(F)});return false})}})})(window);(function(B){var A=B.Gitana;A.BinaryAttachmentMap=A.AbstractPersistable.extend({constructor:function(C,D){this.base(C.getServer());this.objectType="Gitana.BinaryAttachmentMap";this.persistable=C;this.map={};this.handleMap(D);this.getAttachments=function(){var E={};for(var F in this.map){E[F]=this.produce(F,this.map[F])}return E},this.produce=function(E,F){return new A.BinaryAttachment(this.persistable,E,F)}},handleMap:function(D){for(var C in this.map){if(this.map.hasOwnProperty(C)){delete this.map[C]}}if(D){A.copyInto(this.map,D)}},count:function(C){return this.then(function(){var D=A.getNumberOfKeys(this.getAttachments());C.call(this,D)})},each:function(C){return this.then(function(){var E=0;var D=this.getAttachments();for(var G in D){var H=D[G];var F=function(K,J,I){return function(){K.call(this,J,this,I)}}(C,G,E);this.subchain(H).then(F);E++}return this})},select:function(E){var D=this;if(!E){E="default"}var C=this.subchain(this.produce(E));C.subchain().then(function(){var F=D.getAttachments()[E];if(!F){var G=new Error();G.name="No attachment with id: "+E;G.message=G.name;this.error(G);return false}C.handleAttachment(F.attachment)});return C}})})(window);(function(B){var A=B.Gitana;A.NodeAttachment=A.BinaryAttachment.extend({constructor:function(D,C,E){this.base(D,C,E)},getFilename:function(){return this.attachment.filename}})})(window);(function(B){var A=B.Gitana;A.NodeAttachmentMap=A.BinaryAttachmentMap.extend({constructor:function(C,D){this.base(C,D);this.objectType="Gitana.NodeAttachmentMap";this.produce=function(E,F){return new A.NodeAttachment(this.persistable,E,F)}}})})(window);(function(B){var A=B.Gitana;A.Context=A.Chainable.extend({constructor:function(C){this.base(new A(C.driver?C.driver:{}));if(!this.cache){this.cache={}}this.cache.repository=null;this.cache.branch=null;this.cache.server=null;this.getConfigs=function(){return C};this.getRepositoryConfigs=function(){var D=C.repository;if(typeof D=="string"){D={repository:D}}return D};this.getBranchConfigs=function(){var D=C.branch?C.branch:"master";if(typeof D=="string"){if(D=="master"){D={type:"MASTER"}}else{D={_doc:D}}}return D};this.getUserConfigs=function(){return C.user};this.getDriverConfigs=function(){return C.driver}},server:function(C){if(C||C===null){this.cache.server=C}return this.cache.server?Chain(this.cache.server):null},repository:function(C){if(C||C===null){this.cache.repository=C}return this.cache.repository?Chain(this.cache.repository):null},branch:function(C){if(C||C===null){this.cache.branch=C}return this.cache.branch?Chain(this.cache.branch):null},init:function(){var F=this;var E=function(H,I){if(!F.server()){var K=F.getConfigs()["user"]["username"];var J=F.getConfigs()["user"]["password"];F.getDriver().authenticate(K,J,function(L){if(I){I({message:"Failed to login Gitana.",reason:"INVALID_LOGIN",error:L})}}).then(function(){F.server(this);D(H,I)})}else{D(H,I)}};var D=function(H,I){if(!F.repository()){F.server().trap(function(J){if(I){I({message:"Failed to get repository",error:J})}}).queryRepositories(F.getRepositoryConfigs()).count(function(J){if(I){if(J==0){I({message:"Cannot find any repository"})}if(J>1){I({message:"Found more than one repository"})}}}).keepOne().then(function(){F.repository(this);G(H,I)})}else{G(H,I)}};var G=function(H,I){if(!F.branch()){F.repository().trap(function(J){if(I){I({message:"Failed to get branch",error:J})}}).queryBranches(F.getBranchConfigs()).count(function(J){if(I){if(J==0){I({message:"Cannot find any branch"})}if(J>1){I({message:"Found more than one branch"})}}}).keepOne().then(function(){F.branch(this);H.call()})}else{H.call()}};var C=Chain(this);return C.subchain().then(function(){var H=this;E(function(){H.next()},function(J){var I=F.getConfigs()["error"];if(I){I.call(F,J)}});return false})}});A.Context.create=function(C){var D=new A.Context(C);return D.init()}})(window);
